from lib.actions import BaseAction
import json
import os


class SubmitMalwareAction(BaseAction):
    def run(self, **kwargs):
        payload = json.dumps(kwargs)
        file_basename = os.path.basename(kwargs['file_name'])
        files = [
            ('file', (file_basename, open(kwargs['file_name'], 'rb'),
                      kwargs['file_type'])),
            ('file', ('analysis.json', payload, 'application/json'))
        ]
        response = self._api_post('submission', files=files)
        return response
